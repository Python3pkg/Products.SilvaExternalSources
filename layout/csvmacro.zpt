<html xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal">
  <body>
    <!-- Macro ripped from CMFPlone batch_macros.pt. 
    Removed i18n and omit-tag attributes -->
    <!-- Navigation -->
    <div class="listingBar" 
      metal:define-macro="navigation"
      tal:define="request request|here/request|container/request|nothing;
        batch batch|nothing;
        mq python:modules['ZTUtils'].make_query;
        url python:request.get('URL0');
        currentpage batch/pagenumber;"
      tal:condition="python:test(batch.previous or batch.next, 1, 0)">

      <span class="previous" 
        tal:define="p batch/previous | nothing" 
        tal:condition="p"> 
        <a href=""
          tal:attributes="href python: '%s?%s' % (url , mq( request.form, {batch.b_start_str:p.first} ))">
          &laquo;
          Previous
          <span tal:content="p/length">n</span> 
          items</a>
      </span>


      <!-- Link to first -->
      <span tal:condition="python: 1 not in batch.navlist">
        <a href="" 
          tal:attributes="href python: '%s?%s' % (url, batch.pageurl(request.form,1));">1</a> 
          <tal:block condition="python: 2 not in (batch.prevlist or batch.leapback)">
            ...
          </tal:block>
      </span>

      <!-- Pagelist with quantum leap links to previous pages for quick navigation -->
      <tal:block 
        repeat="linklist python:batch.navurls(request.form, batch.leapback)"
        condition="batch/leapback" >
        <a href=""
          tal:define="page python:linklist[0];
            query python:linklist[1];"
          tal:content="page"
          tal:attributes="href python: '%s?%s' % (url,query)" >
        </a>
        ...
      </tal:block>
    
      <!-- Pagelist with links to previous pages for quick navigation -->
      <tal:block 
        repeat="linklist python:batch.prevurls(request.form)"
        condition="batch/prevlist" >
        <a href=""
          tal:define="page python:linklist[0];
            query python:linklist[1];"
          tal:content="page"
          tal:attributes="href python: '%s?%s' % (url,query)" >
        </a>
      </tal:block>

      <!-- Current page -->
      <tal:block condition="batch/navlist">
      <span class="brackets">[</span><span class="currentpage" tal:content="batch/pagenumber">
         Current page number
       </span><span class="brackets">]</span>
      </tal:block>
    
      <!-- Pagelist with links to next pages for quick navigation -->
      <tal:block 
        repeat="linklist python:batch.nexturls(request.form)"
        condition="batch/nextlist">
        <a href=""
          tal:define="page python:linklist[0];
            query python:linklist[1];"
          tal:content="page"
          tal:attributes="href python: '%s?%s' % (url,query)" >
        </a>
      </tal:block>

      <!-- Pagelist with quantum leap links to next pages for quick navigation -->
      <tal:block 
        repeat="linklist python:batch.navurls(request.form, batch.leapforward)"
        condition="batch/leapforward">
        ...
        <a href=""
          tal:define="page python:linklist[0];
            query python:linklist[1];"
          tal:content="page"
          tal:attributes="href python: '%s?%s' % (url,query)" >
        </a>
      </tal:block>
    
      <!-- Link to last -->
      <span tal:condition="python:batch.numpages not in batch.navlist">
        <tal:block condition="python: batch.numpages - 1 not in (batch.nextlist or batch.leapforward)">
          ...
        </tal:block>
        <a href=""
          tal:attributes="href python: '%s?%s' % (url,batch.pageurl(request.form,batch.numpages));"
          tal:content="batch/numpages">3457</a>       
      </span>
      
      <span class="next" 
        tal:define="n batch/next | nothing" 
        tal:condition="n">
        <a href=""
          tal:attributes="href python: '%s?%s' % (url , mq( request.form, {batch.b_start_str:n.first} ))">
          Next
          <span tal:content="n/length">n</span> 
          items &raquo;</a>
      </span>
 
    </div>

  </body>
</html>
